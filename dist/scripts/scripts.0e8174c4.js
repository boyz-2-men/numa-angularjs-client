"use strict";angular.module("numaApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngMessages","satellizer","mgcrea.ngStrap","angularSpinner","ui.bootstrap.tpls","ui.bootstrap.collapse","ui.bootstrap.dropdown","ui.bootstrap.tabs","plangular","contenteditable","angularFileUpload","matchmedia-ng","selectize","angularUtils.directives.dirPagination","btford.socket-io","flow","wu.masonry"]).config(["$routeProvider","$httpProvider","$authProvider","$locationProvider","$popoverProvider","$tooltipProvider","$modalProvider",function(a,b,c,d,e,f,g){c.github({clientId:"a6cf7f2af1739f24601f"}),c.google({clientId:"636774587721-nmkg52cbr188p3rpjda5l0jlndq3ngb0.apps.googleusercontent.com"}),c.facebook({clientId:"551613144966753"}),a.when("/",{templateUrl:"views/feed.html",controller:"FeedCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/logout",{template:null,controller:"LogoutCtrl"}).when("/signup",{templateUrl:"views/signup.html",controller:"SignupCtrl"}).when("/user/:id",{templateUrl:"views/profile.html",controller:"ProfileCtrl"}).when("/forgot",{templateUrl:"views/forgot.html",controller:"ForgotCtrl"}).when("/reset",{templateUrl:"views/reset.html",controller:"ResetCtrl"}).when("/poem/:id",{templateUrl:"views/poem.html",controller:"PoemCtrl"}).when("/feed/",{templateUrl:"views/feed.html",controller:"FeedCtrl",reloadOnSearch:!1}).when("/create",{templateUrl:"views/create.html",controller:"CreateCtrl"}).when("/edit/:id",{templateUrl:"views/edit.html",controller:"EditCtrl"}).when("/privacy",{templateUrl:"views/privacy.html",controller:"PrivacyCtrl"}).when("/terms",{templateUrl:"views/terms.html",controller:"TermsCtrl"}).otherwise({redirectTo:"/"}),b.interceptors.push("tokenInterceptorFactory"),angular.extend(e.defaults,{html:!0}),angular.extend(f.defaults,{html:!0}),angular.extend(g.defaults,{html:!0}),d.hashPrefix("!")}]).factory("socket",function(a,b){var c=io.connect("http://localhost:3000");return c.on("newSocketId",function(a){b.setSocketId(a.id)}),a({ioSocket:c})}),angular.module("numaApp").controller("MainCtrl",["$scope","storageFactory","userFactory",function(a,b,c){var d=b.getId();c.init(d,"Basic"),a.isLoggedIn=function(){var a=b.getToken(),c=b.getId();return a&&c?!0:!1}}]),angular.module("numaApp").controller("AboutCtrl",["$scope",function(){}]),angular.module("numaApp").controller("LoginCtrl",["$location","$scope","userFactory","storageFactory","$auth","$alert","$resource","$http","$rootScope","usSpinnerService",function(a,b,c,d,e,f,g,h,i,j){b.popover={title:"Protect your privacy",content:"If you close your browser without logging out, we'll store an access token to remember you.<br />Other people who use this computer will also be able to log in as you.",checked:!1};var k=!1;"expired"===a.search().session&&(b.err="Session expired. Please login again",k=!0),b.authenticate=function(b){j.spin("login-spinner"),e.authenticate(b).then(function(a){f({type:"material",duration:3,title:"Hello, "+a.data.displayName+"!",content:"You have successfully logged in.",animation:"fadeZoomFadeDown"}),console.log(a),c.setInfo(a.data.id,a.data.displayName),d.setId(a.data.id),i.displayName=a.data.displayName,j.stop("login-spinner"),i.$emit("login")}).catch(function(b){0===b.status?e.logout().then(function(){f({type:"material-err",title:"We've lost connection to our backend.",content:"Please try logging back in.",duration:3,animation:"fadeZoomFadeDown"})}):f({type:"material-err",title:"Oops!",content:b.data.message,duration:3,animation:"fadeZoomFadeDown"}),d.deleteId(),d.deleteToken(),j.stop("login-spinner"),a.path("/login")})},b.login=function(){j.spin("login-spinner");var g={};g.displayName=b.displayName,g.password=b.password,g.stayLoggedIn=b.stayLoggedIn;var h=c.rLogin(g);h.$promise.then(function(b){f({type:"material",duration:3,title:"Hello, "+g.displayName+"!",content:"You have successfully logged in.",animation:"fadeZoomFadeDown"}),c.setInfo(b.id,g.displayName),d.setId(b.id),d.setToken(b.token),a.path("/feed"),i.displayName=g.displayName,i.isAuthenticated=!0,j.stop("login-spinner"),i.$emit("login")},function(b){0===b.status?e.logout().then(function(){f({type:"material-err",title:"We've lost connection to our backend.",content:"Please try logging back in.",duration:3,animation:"fadeZoomFadeDown"})}):f({type:"material-err",title:"Oops!",content:b.data.message,duration:3,animation:"fadeZoomFadeDown"}),d.deleteId(),d.deleteToken(),j.stop("login-spinner"),a.path("/login")})}}]),angular.module("numaApp").controller("SignupCtrl",["$location","$scope","userFactory","storageFactory","$alert","$rootScope","usSpinnerService",function(a,b,c,d,e,f,g){b.popover={title:"Protect your privacy",content:"If you close your browser without logging out, we'll store an access token to remember you.<br />Other people who use this computer will also be able to log in as you.",checked:!1},b.signUp=function(){g.spin("signup-spinner");var h={};h.displayName=b.displayName,h.email=b.email,h.password=b.password,h.stayLoggedIn=b.stayLoggedIn,console.log(h);var i=c.rSignUp(h);i.$promise.then(function(b){e({type:"material",duration:5,title:"Hello, "+h.displayName+"!",content:"You have successfully signed up.",animation:"fadeZoomFadeDown"}),console.log(b),c.setInfo(b.id,h.displayName),d.setId(b.id),d.setToken(b.token),a.path("/feed"),f.displayName=h.displayName,f.isAuthenticated=!0,g.stop("signup-spinner")},function(a){e({type:"material-err",title:"Oops!",content:a.data.message,duration:3,animation:"fadeZoomFadeDown"}),g.stop("signup-spinner")})}}]),angular.module("numaApp").controller("ProfileCtrl",["$scope","userFactory","$alert","storageFactory","$location","$rootScope","$upload","$routeParams","$tooltip","helperFactory",function(a,b,c,d,e,f,g,h,i,j){a.currentUserId=d.getId(),a.userViewId=h.id,b.init(a.userViewId,"full");var k=f.$on("finishedSettingUserDataOnPageRefresh",function(){a.pdfUrl=b.getPdfUrl(a.userViewId),a.displayName=b.getDisplayName(),a.joinedDate=b.getJoinedDate(),a.avatarUrl=b.getAvatarUrl(),a.comments=b.getComments(),a.favoritePoems=b.getFavoritePoems(),a.unreadComments=b.getUnreadComments(),a.unreadFollowingPoems=b.getUnreadFollowingPoems(),a.followersCount=b.getFollowersCount(),a.followingCount=b.getFollowingCount(),a.email=a.workingEmail=b.getEmail();var c=b.getPoems();a.poems=[],a.drafts=[];for(var d=c.length-1;d>=0;--d)c[d].published===!0?a.poems.push(c[d]):a.drafts.push(c[d])});if(f.isAuthenticated&&a.currentUserId!==a.userViewId){var l=b.rGetUserFollowUser(a.userViewId);l.$promise.then(function(b){console.log(b),a.isFollowing="yes"===b.following?!0:!1},function(b){console.log(b),a.isFollowing=!1})}a.$on("$destroy",function(){k()}),a.modal={title:"Are you sure?"},a.tooltipChangeAvatar={title:"Change your avatar",checked:!1},a.tooltipEditProfile={title:"Edit profile.",checked:!1},a.tabs=[{title:"Poems"},{title:"Comments"}],a.editorEnabled=!1,a.sizeLimit=5292880,a.uploading=!1,a.go=j.go,a.restoreScrollbar=j.restoreScrollbar,a.viewFollowing=function(c){if(c===!0)return void(a.viewFollowingEnabled=!1);var d=b.rGetUserFollowing();d.$promise.then(function(b){console.log(b),a.following=b.following,a.viewFollowingEnabled=!0},function(a){console.log(a)})},a.viewFollowers=function(c){if(c===!0)return void(a.viewFollowersEnabled=!1);var d=b.rGetUserFollowers();d.$promise.then(function(b){console.log(b),a.followers=b.followers,a.viewFollowersEnabled=!0},function(a){console.log(a)})},a.followUser=function(){var d=b.rSaveUserFollowUser(a.userViewId);d.$promise.then(function(){a.isFollowing=!0,a.followersCount=parseInt(a.followersCount)+1,c({type:"material",title:"Success!",content:"You are now following "+a.displayName+".",duration:3,animation:"fadeZoomFadeDown"})},function(a){console.log(a)})},a.unfollowUser=function(){var d=b.rSaveUserUnfollowUser(a.userViewId);d.$promise.then(function(){a.isFollowing=!1,a.followersCount=parseInt(a.followersCount)-1,c({type:"material",title:"Success!",content:"You won't receive anymore updates from "+a.displayName+".",duration:3,animation:"fadeZoomFadeDown"})},function(a){console.log(a)})},a.fileSizeLabel=function(){return Math.round(a.sizeLimit/1024/1024)+" MB"},a.uniqueString=function(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;8>c;++c)a+=b.charAt(Math.floor(Math.random()*b.length));return a},a.onFileSelect=function(d){return a.uploading=!0,angular.isArray(d)&&(d=d[0]),"image/png"!==d.type&&"image/jpeg"!==d.type&&"image/jpg"!==d.type&&"image/gif"!==d.type?(c({type:"material-err",title:"Oops!",content:"Only PNG, GIF, JPG, and JPEG are allowed.",duration:3,animation:"fadeZoomFadeDown"}),void(a.uploading=!1)):void(a.upload=g.upload({url:"http://localhost:3000/api/v1/user/"+b.getId()+"/avatar",method:"POST",file:d}).progress(function(a){console.log("percent completed:",parseInt(100*a.loaded/a.total))}).success(function(b){console.log(b),c({type:"material",title:"Success! ",content:"Profile pic updated.",duration:3,animation:"fadeZoomFadeDown"}),a.avatarUrl=b.avatarUrl,a.uploading=!1}).error(function(b){console.log("Error uploading file: "+b.message||b),a.uploading=!1}))},a.enableEditor=function(){a.editorEnabled=!0},a.disableEditor=function(){a.editorEnabled=!1},a.save=function(){var d={};d.email=a.email;var e=b.hUpdateUser(d);e.then(function(){a.editorEnabled=!1,a.workingEmail=a.email,c({type:"material",duration:3,title:"Success!",content:"You have updated your profile.",animation:"fadeZoomFadeDown"})},function(a){c({type:"material-err",title:"Oops!",content:a.data.message,duration:3,animation:"fadeZoomFadeDown"})})},a.deleteAccount=function(){var a=b.rDeleteAccount();a.$promise.then(function(){c({type:"material",duration:3,title:"Success!",content:"You have deleted your account.",animation:"fadeZoomFadeDown"}),d.deleteId(),d.deleteToken(),b.deleteInfo(),e.path("/"),f.isAuthenticated=!1},function(a){c({type:"material-err",title:"Oops!",content:a.data.message,duration:3,animation:"fadeZoomFadeDown"})})},a.markPoemAsRead=function(d){var e=b.rMarkPoemAsRed(d);e.$promise.then(function(){c({type:"material",duration:3,title:"Success!",content:"Poem marked as read.",animation:"fadeZoomFadeDown"});for(var b=a.unreadFollowingPoems.length-1;b>=0;--b)a.unreadFollowingPoems[b].id===d&&a.unreadFollowingPoems.splice(b,1)},function(a){c({type:"material-err",duration:3,title:"Oops!",content:a.data.message,animation:"fadeZoomFadeDown"})})},a.markCommentAsRead=function(d,e){var f=b.rMarkCommentAsRead(d,e);f.$promise.then(function(){c({type:"material",duration:3,title:"Success!",content:"Comment marked as read.",animation:"fadeZoomFadeDown"});for(var b=a.unreadComments.length-1;b>=0;--b)a.unreadComments[b].id===e&&a.unreadComments.splice(b,1)},function(a){c({type:"material-err",duration:3,title:"Oops!",content:a.data.message,animation:"fadeZoomFadeDown"})})},a.deleteComment=function(d,e,f){var g=b.rDeleteComment(d,e);g.$promise.then(function(){if(c({type:"material",duration:3,title:"Success!",content:"Comment deleted.",animation:"fadeZoomFadeDown"}),f===!0)for(var b=a.unreadComments.length-1;b>=0;--b)a.unreadComments[b].id===e&&a.unreadComments.splice(b,1);else for(var b=a.comments.length-1;b>=0;--b)a.comments[b].id===e&&a.comments.splice(b,1)},function(a){c({type:"material-err",duration:3,title:"Oops!",content:a.data.message,animation:"fadeZoomFadeDown"})})}}]),angular.module("numaApp").controller("LogoutCtrl",["$auth","$alert","storageFactory","userFactory","$rootScope",function(a,b,c,d,e){var f=d.rLogout();f.$promise.then(function(f){console.log(f),a.logout().then(function(){b({type:"material",title:"Success!",content:"You've been logged out.",duration:3,animation:"fadeZoomFadeDown"}),c.deleteId(),c.deleteToken(),d.deleteInfo(),e.$emit("logout")})},function(a){console.log(a)})}]),angular.module("numaApp").controller("NavbarCtrl",["$scope","storageFactory","$rootScope","userFactory","$tooltip","$location",function(a,b,c,d,e,f){a.isCollapsed=!0,a.tooltipCreate={title:"Start creating.",checked:!1},a.tooltipFeed={title:"Start reading.",checked:!1},a.tooltipUnreadComments={title:"Someone gave you feedback!",checked:!1},a.tooltipUnreadPoems={title:"Someone you're following recently wrote a new poem!",checked:!1};var g=c.$on("finishedSettingUserDataOnPageRefresh",function(){a.id=b.getId(),a.avatarUrl=d.getAvatarUrl(),a.unreadCommentsCount=d.getUnreadCommentsCount(),a.unreadFollowingPoemsCount=d.getUnreadFollowingPoemsCount()}),h=c.$on("login",function(){a.id=b.getId(),a.avatarUrl=d.getAvatarUrl()}),i=c.$on("logout",function(){a.id=void 0,a.avatarUrl=void 0,f.path("/feed")});a.$on("$destroy",function(){h(),i(),g()}),a.collapse=function(){a.isCollapsed=!a.isCollapsed}}]),angular.module("numaApp").controller("ForgotCtrl",["$scope","$resource","endpointConstants","$alert","$location",function(a,b,c,d,e){a.resetPassword=function(){var f={};f.email=a.email;var g=b(c.forgotPassword).save(f);g.$promise.then(function(a){d({type:"material",duration:3,title:"Success!",content:"An email has been sent to you with further instructions.",animation:"fadeZoomFadeDown"}),console.log(a),e.path("/")},function(a){d({type:"material-err",title:"Oops!",content:a.data.message,duration:3,animation:"fadeZoomFadeDown"}),console.log(a)})}}]),angular.module("numaApp").controller("ResetCtrl",["$scope","$alert","$location","$resource","endpointConstants","usSpinnerService",function(a,b,c,d,e,f){var g=c.search().token;a.reset(),a.reset=function(){if(g){f.spin("resetPassword-spinner");var h=d(e.resetPassword,{token:g}).get();h.$promise.then(function(){a.userExists=!0},function(){f.stop("resetPassword-spinner"),b({type:"material-err",title:"Oops!",content:"Your reset token expired and/or the specified user does not exists. Please request to reset your password again.",duration:4,animation:"fadeZoomFadeDown"}),c.url(c.path()),c.path("/forgot")})}else f.stop("resetPassword-spinner"),b({type:"material-err",title:"Oops!",content:"Please follow the link in the email we sent you to reset your password.",duration:4,animation:"fadeZoomFadeDown"}),c.url(c.path()),c.path("/")},a.updatePassword=function(){if(g){f.spin("resetPassword-spinner");var h={};h.password=a.password;var i=d(e.resetPassword,{token:g}).save([],h);i.$promise.then(function(){f.stop("resetPassword-spinner"),b({type:"material",duration:3,placement:top,title:"Success!",content:"Your password has been changed.",animation:"fadeZoomFadeDown"}),c.path("/login")},function(){f.stop("resetPassword-spinner"),b({type:"material-err",title:"Oops!",content:"Please try again. If the problem persists please request to reset your password again.",duration:3,animation:"fadeZoomFadeDown"})})}else f.stop("resetPassword-spinner"),b({type:"material-err",title:"Oops!",content:"Your reset token expired and/or the specified user does not exists. Please request to reset your password again.",duration:3,animation:"fadeZoomFadeDown"}),c.url(c.path()),c.path("/")}}]),angular.module("numaApp").controller("PoemCtrl",["$scope","$routeParams","poemFactory","storageFactory","userFactory","$alert","helperFactory","$rootScope","$location","socket","$sce","$tooltip",function(a,b,c,d,e,f,g,h,i,j,k){a.userId=d.getId(),e.init(a.userId,"Basic"),a.tags={};var l;if(a.modalDeletePoem={title:"Are you sure?"},a.modalDeleteComment={title:"Are you sure?"},a.tooltipPublished={title:"Published to the feed.",checked:!1},a.poemId=b.id,a.poemId){var m=c.rGet(a.poemId);if(m.$promise.then(function(b){console.log(b),a.creatorAvatarUrl=b.poem.creator.avatarUrl,a.creatorId=b.poem.creator.id,a.creatorDisplayName=b.poem.creator.displayName,a.title=b.poem.title,a.poem=b.poem.poem,a.tags=b.poem.tags.join(", "),a.isPublished=b.poem.published,a.comments=b.poem.comments,a.totalVotes=b.poem.positiveVotes-b.poem.negativeVotes,b.poem.inspirations&&(a.imageUrl=b.poem.inspirations.imageUrl,a.videoUrl=b.poem.inspirations.videoUrl)},function(a){console.log(a)}),h.isAuthenticated){var n=e.rGetVote(a.poemId);n.$promise.then(function(b){a.vote=b.vote},function(a){console.log(a)});var o=e.rGetPoemAsFavoriteStatus(a.poemId);o.$promise.then(function(b){"favorited"===b.status?a.favoritePoem=!0:"not_favorited"===b.status&&(a.favoritePoem=!1)},function(a){console.log(a)})}}a.timeSince=g.timeSince,a.restoreScrollbar=g.restoreScrollbar,a.saveEditedComment=function(b,c){var d={};d.comment=c;var g=e.hUpdateComment(d,a.poemId,b);g.then(function(){f({type:"material",duration:3,title:"Success!",content:"Comment updated.",animation:"fadeZoomFadeDown"})},function(a){f({type:"material-err",title:"Oops!",content:a.data.message,duration:3,animation:"fadeZoomFadeDown"})})},j.forward("newComment",a);var p=a.$on("socket:newComment",function(a,b){console.log("newComment data",b)});a.$on("$destroy",function(){p()}),a.trustSrc=function(a){return k.trustAsResourceUrl(a)},a.playPauseButton=function(){a.audio1.playPause()},a.deletePoem=function(){var b=e.rDeletePoem(a.poemId);b.$promise.then(function(){f({type:"material",duration:3,title:"Success!",content:"You have deleted your poem.",animation:"fadeZoomFadeDown"}),i.path("/feed")},function(a){f({type:"material-err",title:"Oops!",content:a.data.message,duration:3,animation:"fadeZoomFadeDown"})})},a.deleteComment=function(b){var c=e.rDeleteComment(a.poemId,b);c.$promise.then(function(){f({type:"material",duration:3,title:"Success!",content:"Comment deleted.",animation:"fadeZoomFadeDown"});for(var c=a.comments.length-1;c>=0;c--)a.comments[c].id===b&&a.comments.splice(c,1);console.log(a.comments)},function(a){f({type:"material-err",duration:3,title:"Oops",content:a.data.message,animation:"fadeZoomFadeDown"})})},a.saveComment=function(){var b={};if(b.comment=a.comment,""===b.comment||void 0===b.comment)return void f({type:"material-err",duration:3,title:"Oops!",content:"You haven't written anything!",animation:"fadeZoomFadeDown"});var c=e.rSaveComment(b,a.poemId);c.$promise.then(function(c){j.emit("newComment",{creatorId:a.creatorId}),a.comment="",f({type:"material",duration:3,title:"Success!",content:"Comment saved.",animation:"fadeZoomFadeDown"});var g={};g.id=d.getId(),g.displayName=e.getDisplayName(),g.avatarUrl=e.getAvatarUrl();var h={};h.id=c.commentId,h.comment=b.comment,h.creator=g,h.createdAt=new Date,console.log(c),a.comments.push(h)},function(a){f({type:"material-err",title:"Oops!",content:a.data.message,duration:3,animation:"fadeZoomFadeDown"})})},a.saveFavoritedPoem=function(){var b=e.rSavePoemAsFavorite(a.poemId);b.$promise.then(function(b){console.log(b),"favorited"===b.status?a.favoritePoem=!0:"removed"===b.status&&(a.favoritePoem=!1)},function(a){console.log(a)})},a.changeVote=function(b,c){l=a.vote,a.vote=b===c?"None":c,console.log(a.vote);var d={};d.vote=a.vote;var f=e.rSaveVote(d,a.poemId);f.$promise.then(function(b){console.log(b),"up"===d.vote&&"None"===l||"None"===d.vote&&"down"===l?a.totalVotes+=1:"up"===d.vote&&"down"===l?a.totalVotes+=2:"down"===d.vote&&"None"===l||"None"===d.vote&&"up"===l?a.totalVotes-=1:"down"===d.vote&&"up"===l&&(a.totalVotes-=2)},function(a){console.log(a)})}}]),angular.module("numaApp").controller("FeedCtrl",["$scope","poemFactory","storageFactory","userFactory","helperFactory","socket","$rootScope","$cookieStore","$location","$resource",function(a,b,c,d,e,f,g,h,i){function j(c,d,e,f,g){var h=b.rGetQuery(c,d,e,f,g);h.$promise.then(function(b){a.currentPage=c,i.search("page",a.currentPage),a.poems=b.poems,a.totalPoems=b.poemCount,a.pageCount=b.pageCount},function(a){console.log(a)})}var k=c.getId();if(d.init(k,"Basic"),a.poems=[],a.totalPoems=0,a.poemsPerPage=15,a.searchByTitle=!1,a.searchByTag=!1,a.searchByContent=!1,a.strictSearch=!1,a.currentPage=parseInt(i.search().page)||1,a.queryParam=i.search().query,a.queryParam&&(a.query=a.queryParam),a.searchbyParam=i.search().searchby,a.searchbyParam)for(var l=a.searchbyParam.split(","),m=l.length-1;m>=0;--m)"title"===l[m]?a.searchByTitle=!0:"content"===l[m]?a.searchByContent=!0:"tag"===l[m]&&(a.searchByTag=!0);a.strictSearchParam=i.search().strict,a.strictSearchParam&&(a.strictSearch=!0),a.sortbyParam=i.search().sortby,a.sortbyParam&&(a.sortByVotes=!0),j(a.currentPage,a.queryParam,a.searchbyParam,a.strictSearchParam,a.sortbyParam),a.pagination={current:1};var n=b.rGetCount();n.$promise.then(function(b){a.poemCount=b.count},function(a){console.log(a)}),a.timeSince=e.timeSince,a.searchPoems=function(){"undefined"!=typeof a.query?i.search("query",a.query):i.search("query",null),a.strictSearch===!0?i.search("strict","true"):i.search("strict",null),a.sortByVotes===!0?i.search("sortby","votes"):i.search("sortby",null),a.searchByTag===!0&&a.searchByTitle===!1&&a.searchByContent===!1?i.search("searchby","tag").search("strict",null):a.searchByTag===!1&&a.searchByTitle===!0&&a.searchByContent===!1?i.search("searchby","title").search("strict",null):a.searchByTag===!1&&a.searchByTitle===!1&&a.searchByContent===!0?i.search("searchby","content").search("strict",null):a.searchByTag===!0&&a.searchByTitle===!0&&a.searchByContent===!1?i.search("searchby","tag,title"):a.searchByTag===!0&&a.searchByTitle===!0&&a.searchByContent===!0?i.search("searchby","tag,title,content"):a.searchByTag===!1&&a.searchByTitle===!0&&a.searchByContent===!0?i.search("searchby","title,content"):a.searchByTag===!1&&a.searchByTitle===!1&&a.searchByContent===!1&&i.search("searchby",null),a.queryParam=i.search().query,a.searchbyParam=i.search().searchby,a.strictSearchParam=i.search().strict,a.sortbyParam=i.search().sortby,j(a.currentPage,a.queryParam,a.searchbyParam,a.strictSearchParam,a.sortbyParam)},a.nextPage=function(){j(parseInt(a.currentPage)+1,a.queryParam,a.searchbyParam,a.strictSearchParam,a.sortbyParam)},a.previousPage=function(){j(parseInt(a.currentPage)-1,a.queryParam,a.searchbyParam,a.strictSearchParam,a.sortbyParam)},a.pageChanged=function(a){j(a)}}]),angular.module("numaApp").controller("CreateCtrl",["$scope","$resource","$alert","userFactory","$location","storageFactory","$upload","$sce","$tooltip",function(a,b,c,d,e,f,g){var h=f.getId();d.init(h,"Basic"),a.tagOptions=["love","life","happiness"],a.tagConfig={create:!0,placeholder:"Add tags to your poem for others to easily find it..."},a.publishPopover={title:"Publishing",content:"Publish your poem to the main feed for others to enjoy and provide feedback.<br /> Otherwise it will be saved as a draft which you can find from your profile.",checked:!1},a.title="Untitled",a.savePoemAndImage=function(b){if(""===a.poem||void 0===a.poem)return void c({type:"material-err",duration:3,title:"Oops!",content:"You haven't written anything yet.",animation:"fadeZoomFadeDown"});if(""===a.title||void 0===a.poem||"Untitled"===a.title)return void c({type:"material-err",duration:3,title:"Oops!",content:"You haven't spiced up your title.",animation:"fadeZoomFadeDown"});if("undefined"!=typeof b&&b.length>0){if(angular.isArray(b)&&(b=b[0]),"image/png"!==b.file.type&&"image/jpeg"!==b.file.type&&"image/jpg"!==b.file.type&&"image/gif"!==b.file.type)return c({type:"material-err",duration:3,title:"Oops!",content:"Only PNG, GIF, JPG, and JPEG are allowed.",animation:"fadeZoomFadeDown"}),void b.cancel();a.upload=g.upload({url:"http://localhost:3000/api/v1/user/"+f.getId()+"/poem/image",method:"POST",file:b.file}).success(function(b){var f={};f.poem=a.poem,f.title=a.title,f.tags=a.tags,f.videoUrl=a.videoUrl,f.published=a.toPublish||!1,f.imageUrl=b.imageUrl;var g=d.rSavePoem(f);g.$promise.then(function(){c({type:"material",duration:3,title:"Success!",content:"Your poem has been saved.",animation:"fadeZoomFadeDown"}),e.path("/feed")},function(a){c({type:"material-err",title:"Oops!",content:a.data.message,duration:3,animation:"fadeZoomFadeDown"})})}).error(function(a){console.log("Error uploading file: "+a.message||a)})}else{var h={};h.poem=a.poem,h.title=a.title,h.tags=a.tags,h.videoUrl=a.videoUrl,h.published=a.toPublish||!1;var i=d.rSavePoem(h);i.$promise.then(function(){c({type:"material",duration:3,title:"Success!",content:"Your poem has been saved.",animation:"fadeZoomFadeDown"}),e.path("/feed")},function(a){c({type:"material-err",title:"Oops!",content:a.data.message,duration:3,animation:"fadeZoomFadeDown"})})}}}]),angular.module("numaApp").controller("EditCtrl",["$scope","$routeParams","poemFactory","storageFactory","userFactory","$alert","$location","$upload",function(a,b,c,d,e,f,g,h){a.userId=d.getId(),e.init(a.userId,"Basic"),a.tagOptions=["love","life","happiness"],a.tagConfig={create:!0,placeholder:"Add tags to your poem for others to easily find it..."},a.publishPopover={title:"Publishing",content:"Publish your poem to the main feed for others to enjoy and provide feedback.<br /> Otherwise it will be saved as a draft which you can find from your profile.",checked:!1};var i=b.id;if(i){var j=c.rGet(i);j.$promise.then(function(b){console.log(b),a.title=b.poem.title,a.poem=b.poem.poem,a.tags=b.poem.tags,a.toPublish=b.poem.published,b.poem.inspirations&&(a.imageUrl=b.poem.inspirations.imageUrl||void 0,a.videoUrl=b.poem.inspirations.videoUrl||void 0)},function(a){console.log(a)})}a.removeImage=function(){if(a.imageUrl){var b={};b.imageUrl=a.imageUrl,b.id=i;var c=e.hDeletePoemImage(b);c.then(function(b){console.log(b),a.imageUrl=void 0},function(a){console.log(a)})}},a.updatePoemAndImage=function(c){if(""===a.poem||void 0===a.poem)return void f({type:"material-err",duration:3,title:"Oops!",content:"You haven't written anything yet!",animation:"fadeZoomFadeDown"});if(""===a.title||void 0===a.poem||"Untitled"===a.title)return void f({type:"material-err",duration:3,title:"Oops!",content:"You haven't spiced up your title!",animation:"fadeZoomFadeDown"});var i={};if(i.id=b.id,i.poem=a.poem,i.title=a.title,i.tags=a.tags,i.videoUrl=a.videoUrl,i.published=a.toPublish,c.length>0&&void 0!==c){if(angular.isArray(c)&&(c=c[0]),"image/png"!==c.file.type&&"image/jpeg"!==c.file.type&&"image/jpg"!==c.file.type&&"image/gif"!==c.file.type)return f({type:"material-err",duration:3,title:"Oops!",content:"Only PNG, GIF, JPG, and JPEG are allowed.",animation:"fadeZoomFadeDown"}),void c.cancel();a.upload=h.upload({url:"http://localhost:3000/api/v1/user/"+d.getId()+"/poem/image",method:"POST",file:c.file}).success(function(a){i.imageUrl=a.imageUrl;var b=e.hUpdatePoem(i);b.then(function(){f({type:"material",duration:3,title:"Success!",content:"Your poem has been updated.",animation:"fadeZoomFadeDown"}),g.path("/poem/"+i.id)},function(a){f({type:"material-err",title:"Oops!",content:a.data.message,duration:3,animation:"fadeZoomFadeDown"})})}).error(function(a){console.log("Error uploading file: "+a.message||a)})}else{i.imageUrl=a.imageUrl;var j=e.hUpdatePoem(i);j.then(function(){f({type:"material",duration:3,title:"Success!",content:"Your poem has been updated.",animation:"fadeZoomFadeDown"}),g.path("/poem/"+i.id)},function(a){f({type:"material-err",title:"Oops!",content:a.data.message,duration:3,animation:"fadeZoomFadeDown"})})}}}]),angular.module("numaApp").controller("PrivacyCtrl",["$scope",function(){}]),angular.module("numaApp").controller("TermsCtrl",["$scope",function(){}]);var serverDomain="http://localhost:3000",apiVersion="/api/v1";angular.module("numaApp").constant("endpointConstants",{allUsers:serverDomain+apiVersion+"/user",user:serverDomain+apiVersion+"/user/:id",userAvatar:serverDomain+apiVersion+"/user/:id/avatar",userPoemSave:serverDomain+apiVersion+"/user/:id/poem",userLogout:serverDomain+apiVersion+"/user/:id/logout",userPoemImage:serverDomain+apiVersion+"/user/:id/poem/image",userFollowUser:serverDomain+apiVersion+"/user/:id/follow/user/:followingId",userUnfollowUser:serverDomain+apiVersion+"/user/:id/unfollow/user/:followingId",allUserFollowers:serverDomain+apiVersion+"/user/:id/follower",allUserFollowing:serverDomain+apiVersion+"/user/:id/following",userPoemImageDelete:serverDomain+apiVersion+"/user/:userId/poem/:poemId/image",userPoem:serverDomain+apiVersion+"/user/:userId/poem/:poemId",userPoemFavorite:serverDomain+apiVersion+"/user/:userId/poem/:poemId/favorite",userPoemCommentSave:serverDomain+apiVersion+"/user/:userId/poem/:poemId/comment",userPoemComment:serverDomain+apiVersion+"/user/:userId/poem/:poemId/comment/:commentId",userPoemRead:serverDomain+apiVersion+"/user/:userId/read/poem/:poemId",userCommentRead:serverDomain+apiVersion+"/user/:userId/read/comment/:commentId/",userPoemVote:serverDomain+apiVersion+"/user/:userId/poem/:poemId/vote",userSignup:serverDomain+apiVersion+"/signup",userLogin:serverDomain+apiVersion+"/login",forgotPassword:serverDomain+apiVersion+"/forgot",resetPassword:serverDomain+apiVersion+"/reset/:token",allPoems:serverDomain+apiVersion+"/poem",poem:serverDomain+apiVersion+"/poem/:id",poemCount:serverDomain+apiVersion+"/poem/count"}),angular.module("numaApp").constant("storageConstants",{id:"id",socketId:"socketId"}),angular.module("numaApp").factory("storageFactory",["storageConstants","$cookieStore","$window",function(a,b,c){var d={};return d.setToken=function(a){c.localStorage.satellizer_token=a},d.setId=function(c){b.put(a.id,c)},d.setSocketId=function(c){b.put(a.socketId,c)},d.getId=function(){return b.get(a.id)},d.getToken=function(){return c.localStorage.satellizer_token},d.getSocketId=function(){return b.get(a.socketId)},d.deleteId=function(){b.remove(a.id)},d.deleteToken=function(){delete c.localStorage.satellizer_token},d}]),angular.module("numaApp").factory("tokenInterceptorFactory",["$q","storageFactory","$cookies",function(a,b){var c={};return c.request=function(a){a.headers=a.headers||{};var c=b.getToken(),d=b.getSocketId();return c&&(a.headers.Authorization="Bearer "+c),d&&(a.headers.SocketId=d),a},c.response=function(b){return b||a.when(b)},c}]),angular.module("numaApp").factory("helperFactory",["$location","storageFactory","userFactory",function(a){return{go:function(b){a.path(b)},restoreScrollbar:function(){$("body").removeClass("modal-open")},timeSince:function(a){"object"!=typeof a&&(a=new Date(a));var b,c=Math.floor((new Date-a)/1e3),d=Math.floor(c/31536e3);return d>=1?b="year":(d=Math.floor(c/2592e3),d>=1?b="month":(d=Math.floor(c/86400),d>=1?b="day":(d=Math.floor(c/3600),d>=1?b="hour":(d=Math.floor(c/60),d>=1?b="minute":(d=c,b="second"))))),(d>1||0===d)&&(b+="s"),d+" "+b}}}]),angular.module("numaApp").factory("userFactory",["endpointConstants","$resource","storageFactory","$rootScope","$location","$auth","$alert","$http",function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r=[],s=[],t=[],u=[],v=[],w=c.getId(),x=c.getToken(),y=!1,z={},A="http://localhost:3000",B="/api/v1";return z.init=function(h,i){var j=c.getId();if(console.log("id:",j),console.log("params id:",h),h){console.log("yes here"),i="full"===i?"profile=full":"";var k=b(a.user+"/?"+i,{id:h}).get();k.$promise.then(function(a){console.log("success!"),console.log(a),z.setInfo(a.id,a.displayName,a.createdAt.split("T")[0],a.email,a.avatarUrl,a.unreadCommentsCount,a.unreadFollowingPoemsCount,a.followersCount,a.followingCount),j===h?(console.log("Viewing own profile"),d.displayName=a.displayName,d.isAuthenticated=!0):console.log("Viewing other user profile"),"profile=full"===i&&(z.setPoems(a.poems),z.setComments(a.comments),z.setFavoritePoems(a.favoritePoems),z.setUnreadComments(a.unreadComments),z.setUnreadFollowingPoems(a.unreadFollowingPoems)),d.$emit("finishedSettingUserDataOnPageRefresh")},function(a){console.log("err:",a),0===a.status&&(f.logout().then(function(){g({type:"material-err",title:"We've lost connection to our backend.",content:"Please try logging back in.",duration:3}),c.deleteId(),c.deleteToken(),z.deleteInfo()}),e.path("/login")),"token_expired"===a.data.type&&(f.logout().then(function(){g({type:"material-err",title:"Your session has expired.",content:"Please log back in to continue.",duration:3}),c.deleteId(),c.deleteToken(),z.deleteInfo()}),e.path("/login"))})}else d.isAuthenticated===!0?(f.logout().then(function(){g({type:"material-err",title:"Your browser's session cookie has been removed.",content:"Please try logging back in.",duration:3}),c.deleteId(),c.deleteToken(),z.deleteInfo()
}),e.path("/login")):console.log("no cookie or token found")},z.setInfo=function(a,b,c,d,e,f,g,h,r){i=a,j=b,k=c,l=d,m=e,n=f,o=g,p=h,q=r,y=!0},z.setIsLoggedIn=function(a){y=a},z.setId=function(a){i=a},z.setDisplayName=function(a){j=a},z.setJoinedDate=function(a){k=a},z.setEmail=function(a){l=a},z.setAvatarUrl=function(a){m=a},z.setUnreadCommentsCount=function(a){n=a},z.setUnreadFollowingPoemsCount=function(a){o=a},z.setFollowersCount=function(a){p=a},z.setFollowingCount=function(a){q=a},z.setUnreadComments=function(a){u=a},z.setUnreadFollowingPoems=function(a){v=a},z.setPoems=function(a){r=a},z.setComments=function(a){s=a},z.setFavoritePoems=function(a){t=a},z.getIsLoggedIn=function(){return y},z.getId=function(){return i},z.getDisplayName=function(){return j},z.getJoinedDate=function(){return k},z.getEmail=function(){return l},z.getAvatarUrl=function(){return m},z.getUnreadCommentsCount=function(){return n},z.getUnreadFollowingPoemsCount=function(){return o},z.getFollowersCount=function(){return p},z.getFollowingCount=function(){return q},z.getUnreadComments=function(){return u},z.getUnreadFollowingPoems=function(){return v},z.getPoems=function(){return r},z.getComments=function(){return s},z.getFavoritePoems=function(){return t},z.getPdfUrl=function(a){return"http://localhost:3000/api/v1/user/"+a+"/poem/pdf"},z.deleteInfo=function(){w=void 0,x=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=void 0,q=void 0,r=void 0,s=void 0,t=void 0,u=void 0,v=void 0,y=!1},z.rSignUp=function(c){return b(a.userSignup).save([],c)},z.rLogin=function(c){return b(a.userLogin).save([],c)},z.rLogout=function(){return w=c.getId(),b(a.userLogout,{id:w}).get()},z.rDeleteAccount=function(){return w=c.getId(),b(a.user,{id:w}).delete()},z.rGetUser=function(){return w=c.getId(),b(a.user,{id:w}).get()},z.rSaveAvatarUrl=function(d){return w=c.getId(),b(a.userAvatar,{id:w}).save([],d)},z.rSavePoem=function(d){return w=c.getId(),b(a.userPoemSave,{id:w}).save([],d)},z.rDeletePoem=function(d){return w=c.getId(),b(a.userPoem,{userId:w,poemId:d}).delete()},z.rSaveComment=function(d,e){return w=c.getId(),b(a.userPoemCommentSave,{userId:w,poemId:e}).save([],d)},z.rDeleteComment=function(d,e){return w=c.getId(),b(a.userPoemComment,{userId:w,poemId:d,commentId:e}).delete()},z.rMarkCommentAsRead=function(d,e){return w=c.getId(),b(a.userCommentRead,{userId:w,commentId:e}).delete()},z.rMarkPoemAsRed=function(d){return w=c.getId(),b(a.userPoemRead,{userId:w,poemId:d}).delete()},z.rSaveVote=function(d,e){return w=c.getId(),b(a.userPoemVote,{userId:w,poemId:e}).save([],d)},z.rGetVote=function(d){return w=c.getId(),b(a.userPoemVote,{userId:w,poemId:d}).get()},z.rSavePoemAsFavorite=function(d){return w=c.getId(),b(a.userPoemFavorite,{userId:w,poemId:d}).save()},z.rGetPoemAsFavoriteStatus=function(d){return w=c.getId(),b(a.userPoemFavorite,{userId:w,poemId:d}).get()},z.rSaveUserFollowUser=function(d){return w=c.getId(),b(a.userFollowUser,{id:w,followingId:d}).save()},z.rSaveUserUnfollowUser=function(d){return w=c.getId(),b(a.userUnfollowUser,{id:w,followingId:d}).save()},z.rGetUserFollowUser=function(d){return w=c.getId(),b(a.userFollowUser,{id:w,followingId:d}).get()},z.rGetUserFollowers=function(){return w=c.getId(),b(a.allUserFollowers,{id:w}).get()},z.rGetUserFollowing=function(){return w=c.getId(),b(a.allUserFollowing,{id:w}).get()},z.hUpdateUser=function(a){return w=c.getId(),h({method:"PUT",url:A+B+"/user/"+w,data:{email:a.email}})},z.hUpdatePoem=function(a){return w=c.getId(),h({method:"PUT",url:A+B+"/user/"+w+"/poem/"+a.id,data:a})},z.hUpdateComment=function(a,b,d){return w=c.getId(),h({method:"PUT",url:A+B+"/user/"+w+"/poem/"+b+"/comment/"+d,data:a})},z.hDeletePoemImage=function(a){return w=c.getId(),h({method:"DELETE",url:A+B+"/user/"+w+"/poem/"+a.id+"/image",headers:{"Content-Type":"application/json;charset=utf-8"},data:{imageUrl:a.imageUrl}})},z}]),angular.module("numaApp").factory("poemFactory",["$resource","endpointConstants",function(a,b){var c={};return c.rGet=function(c){return a(b.poem,{id:c}).get()},c.rGetCount=function(){return a(b.poemCount).get()},c.rGetQuery=function(c,d,e,f,g){return c="undefined"!=typeof c?"page="+c+"&":"",d="undefined"!=typeof d?"query="+d+"&":"",e="undefined"!=typeof e?"searchby="+e+"&":"",f="undefined"!=typeof f?"strict=true&":"",g="undefined"!=typeof g?"sortby=votes":"",a(b.allPoems+"/?"+c+d+e+f+g).get()},c}]),angular.module("numaApp").directive("passwordStrength",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e=b.children(),f=Array.prototype.slice.call(e.children()),g=f.slice(-1)[0],h=f.slice(-2),i=f.slice(-3),j=f.slice(-4);b.after(e),b.bind("keyup",function(){angular.forEach(f,function(a){a.style.backgroundColor="#ebeef1"}),d.$modelValue&&(d.$modelValue.length>8?angular.forEach(j,function(a){a.style.backgroundColor="#008cdd"}):d.$modelValue.length>5?angular.forEach(i,function(a){a.style.backgroundColor="#6ead09"}):d.$modelValue.length>3?angular.forEach(h,function(a){a.style.backgroundColor="#e09115"}):g.style.backgroundColor="#e01414")})},template:'<span class="password-strength-indicator"><span></span><span></span><span></span><span></span></span>'}}),angular.module("numaApp").directive("repeatPassword",function(){return{require:"ngModel",link:function(a,b,c,d){var e=b.inheritedData("$formController")[c.repeatPassword];d.$parsers.push(function(a){return a===e.$viewValue?(d.$setValidity("repeat",!0),a):void d.$setValidity("repeat",!1)}),e.$parsers.push(function(a){return d.$setValidity("repeat",a===d.$viewValue),a})}}}),angular.module("numaApp").directive("file",function(){return{restrict:"AE",scope:{file:"@"},link:function(a,b){b.bind("change",function(b){var c=b.target.files,d=c[0];a.file=d,a.$parent.file=d,a.$apply()})}}});